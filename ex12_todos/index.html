<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Todos</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.6/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
</head>
<body>

<div id="app"></div>
<script type="text/jsx">

var Input = React.createClass({
  componentDidMount: function() {
    this.refs.todo.value = '';
    this.refs.todo.focus();
  },
  stateValue: function(e) {
    e.preventDefault();
    var _refTodo = this.refs.todo;
    if (_refTodo.value.trim() !== '') {
      this.props.todoLength();
      this.props.handle(_refTodo.value);
      //this.props.onChk('true');
      _refTodo.value = '';
    } else {
      alert('값을 입력하세요.');
      _refTodo.value = '';
      _refTodo.focus();
      return false;
    }

  },
  render: function() {
    return (
      <form onSubmit={this.stateValue}>
        <input
          type="text"
          className="input-todo"
          ref="todo"
        />
        <input type="submit" value="입력" onClick={this.stateValue} />
      </form>
    );
  }
});
var Lists = React.createClass({
  //let checkTrueFalse = false;
  handleClick: function(e) {
    var evt = e || event;
    console.log('e  ', evt.target.checked);
    if (evt.target.checked) {
      this.props.onChk(evt.target.checked);
      //checkTrueFalse = evt.target.checked;
    }
  },
  render: function() {
    const labelAddStyle = {
      color: 'red',
      textDecoration: 'line-through'
    };
    const spanAddStyle = {
      color: '#000'
    };
    return <li>
            <label for={'chk'+this.props.len}>
              <input type="checkbox" id={'chk'+this.props.len} onClick={this.handleClick} />
              <span>#{this.props.len+1} - {this.props.items}</span>
            </label>
          </li>
  }
});
var Todos = React.createClass({
  getInitialState: function() {
    return {
      data: ['choi', 'young'],
      checked: false,
      count: 0
    }
  },
  handleInputValue: function(arg) {
    this.setState({
      data: this.state.data.concat(arg),
    });
  },
  onIsChecked: function(isChecked) {
    console.log('isChecked   ', isChecked);
    this.setState({
      checked: isChecked
    });
  },
  onTodosLength: function() {
    //this.refs.todosLength.children = 3;
    this.setState({
      count: this.state.data.length + 1
    })
  },
  componentDidMount: function() {
    this.setState({
      count: this.state.data.length
    })
  },
  render: function() {
    return (
      <div>
        <Input
          handle={this.handleInputValue}
          todoLength={this.onTodosLength}
        />
        <h1>할일 목록: <span ref="todosLength">{this.state.count + ' ea'}</span></h1>
        <div>
          <ul>
          {
            this.state.data.map(function(item, idx) {
              return <Lists
                key={item+idx}
                items={item}
                onChk={this.onIsChecked}
                len={idx}
              />
            })
          }
        </ul>
        </div>
      </div>
    );
  }
});

React.render(
  <Todos />,
  document.getElementById('app')
)
</script>
</body>
</html>
